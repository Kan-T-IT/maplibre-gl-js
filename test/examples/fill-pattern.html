<!DOCTYPE html>
<html lang="en">
<head>
    <title>Add a pattern to a polygon</title>
    <meta property="og:description" content="Use fill-pattern to draw a polygon from a repeating image pattern." />
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='../../dist/maplibre-gl.css' />
    <script src='../../dist/maplibre-gl-dev.js'></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    const map = new maplibregl.Map({
        container: 'map',
        showOverdrawInspector: true,
        showCollisionBoxes: true,
        style: {
            version: 8,
            sources: {
                'shape-source': {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Polygon',
                            'coordinates': [
                                [
                                    [0.005, -0.005],
                                    [-0.005, -0.005],
                                    [-0.005, 0.005],
                                    [0.005, 0.005],
                                ]
                            ]
                        },
                        'properties': {
                            'render_height': 200
                        }
                    }
                }
            },
            layers: [
                {
                    'id': '3d-test',
                    'source': 'shape-source',
                    'type': 'line',
                    'layout': {
                        visibility: 'none'
                    },
                    'paint': {
                        'line-color': 'blue',
                        'line-width': 4
                    }
                },
    
            ]
        },
        center: [0.0, 0.0],
        zoom: 14.001,
    });

    const eventImagesLoaded = new Event('image-loaded');
const images = [];

document.addEventListener('image-loaded', () => {

        console.log('images-loaded!!');
        if (images.length < 2) return;
    
        map.addLayer({
            'id': 'pattern-layer',
            'type': 'fill',
            'source': 'shape-source',
            'paint': {
                'fill-pattern': [
                    'step', ['zoom'], 'pattern-a', 14, 'pattern-b'
                ]
            }
        });
});

map.on('load', () => {
        map.loadImage(
            'https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Red_square.svg/120px-Red_square.svg.png?20190714071002',
            (err, imageA) => {
                // Throw an error if something went wrong
                if (err) throw err;
                images.push(imageA);
                map.addImage('pattern-a', imageA);
                document.dispatchEvent(eventImagesLoaded);
    
                map.loadImage(
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Dog_group_Sighthounds.svg/64px-Dog_group_Sighthounds.svg.png',
                    (err, imageB) => {
                        // Throw an error if something went wrong
                        if (err) throw err;
                        images.push(imageB);
                        map.addImage('pattern-b', imageB);
                        document.dispatchEvent(eventImagesLoaded);
                    }
                );
            }
        );

});
map.showTileBoundaries = true;
map.showCollisionBoxes = true;

</script>
</body>
</html>